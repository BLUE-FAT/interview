(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a6fe1ff8"],{"188b":function(e,t,n){},"51f9":function(e,t,n){"use strict";var s=n("8077"),o=n.n(s);o.a},"73cf":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"wrapper"},[n("img",{staticClass:"logo",attrs:{src:"/",alt:""}}),e.role?n("Register",{attrs:{role:e.role}}):n("ChooseRole",{attrs:{role:e.role},on:{"update:role":function(t){e.role=t}}})],1)},o=[],i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"choose-warpper"},[n("div",[n("i",{staticClass:"el-icon-arrow-left",on:{click:e.goBack}}),e._v("注册账号 ")]),n("div",{staticClass:"choose-font"},[e._v("请选择您在日常教学中的实际身份")]),n("div",{staticClass:"img-wrapper"},[n("div",[n("img",{staticClass:"choose-img",attrs:{src:"/",alt:""},on:{click:function(t){e.chooseRole=e.global.role_teacher}}}),n("div",{staticClass:"img-font"},[e._v("我是老师/助教")])]),n("div",[n("img",{staticClass:"choose-img",attrs:{src:"/",alt:""},on:{click:function(t){e.chooseRole=e.global.role_student}}}),n("div",{staticClass:"img-font"},[e._v("我是学生")])])])])},r=[],l={name:"",props:{role:String},data:function(){return{}},computed:{chooseRole:{get:function(){return this.role},set:function(e){this.$emit("update:role",e)}}},methods:{goBack:function(){var e=this;this.$store.dispatch("user/resetToken").then((function(){return e.$router.push("/login")}))}}},a=l,c=(n("a169"),n("2877")),u=Object(c["a"])(a,i,r,!1,null,"5cb82c66",null),d=u.exports,h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"register-warpper"},[n("div",{staticClass:"title"},[n("i",{staticClass:"el-icon-arrow-left",on:{click:e.goBack}}),n("span",[e._v(e._s(e.role===e.global.role_teacher?"老师注册":"学生注册"))])]),n("el-input",{attrs:{placeholder:"姓名"},model:{value:e.user.name,callback:function(t){e.$set(e.user,"name",t)},expression:"user.name"}}),e.role===e.global.role_student?n("el-input",{attrs:{placeholder:"学号"},model:{value:e.userExtension.sno,callback:function(t){e.$set(e.userExtension,"sno",t)},expression:"userExtension.sno"}}):e._e(),n("el-select",{attrs:{placeholder:"学院"},on:{change:e.changeCollegeId},model:{value:e.userExtension.collegeId,callback:function(t){e.$set(e.userExtension,"collegeId",t)},expression:"userExtension.collegeId"}},e._l(e.collegeOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),e.role===e.global.role_student?n("el-select",{attrs:{placeholder:"专业"},model:{value:e.userExtension.professionId,callback:function(t){e.$set(e.userExtension,"professionId",t)},expression:"userExtension.professionId"}},e._l(e.professionOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1):e._e(),e.role===e.global.role_student?n("el-select",{attrs:{placeholder:"入学年份"},model:{value:e.userExtension.grade,callback:function(t){e.$set(e.userExtension,"grade",t)},expression:"userExtension.grade"}},e._l(e.gradeOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e(),n("el-button",{staticClass:"login-button",attrs:{type:"primary",loading:e.loading},on:{click:e.handleLogin}},[e._v("登录")])],1)},f=[],g=(n("4160"),n("a630"),n("13d5"),n("b0c0"),n("b64b"),n("3ca3"),n("159b"),n("f3f3")),p=n("c24f"),v={name:"",props:{role:String},data:function(){return{user:{name:null},userExtension:{sno:null,collegeId:null,professionId:null,grade:null},redirect:null,otherQuery:null,loading:!1,gradeOptions:[],collegeOptions:[],professionOptions:[]}},watch:{$route:{handler:function(e){var t=e.query;t&&(this.redirect=t.redirect,this.otherQuery=this.getOtherQuery(t))},immediate:!0}},mounted:function(){this.getGradeList(),this.getCollegeList()},methods:{goBack:function(){var e=this;this.$store.dispatch("user/resetToken").then((function(){return e.$router.push("/login")}))},handleLogin:function(){var e,t,n=this;if(this.role===this.global.role_student){if(!/^[0-9]*$/g.test(this.userExtension.sno))return void this.$message.warning("学号只支持数字");if(!this.user.name||!this.userExtension.sno||!this.userExtension.collegeId||!this.userExtension.professionId||!this.userExtension.grade)return void this.$message.warning("请填写完整信息")}else if(!this.user.name||!this.userExtension.collegeId)return void this.$message.warning("请填写完整信息");this.loading=!0,this.collegeOptions.forEach((function(t){t.id===n.userExtension.collegeId&&(e=t.name)})),this.professionOptions.forEach((function(e){e.id===n.userExtension.professionId&&(t=e.name)})),Object(p["f"])(Object(g["a"])(Object(g["a"])({},this.user),{},{roleKeys:[this.role]}),Object(g["a"])(Object(g["a"])({},this.userExtension),{},{school:"鲁东大学",schoolId:1,college:e,profession:t})).then((function(){n.$router.push({path:n.redirect||"/",query:n.otherQuery}),n.loading=!1})).catch((function(){n.loading=!1}))},getOtherQuery:function(e){return Object.keys(e).reduce((function(t,n){return"redirect"!==n&&(t[n]=e[n]),t}),{})},getGradeList:function(){var e=this.moment().format("YYYY"),t=Array.from({length:4},(function(t,n){var s={};return s.value=+e-3+n,s.label="".concat(+e-3+n,"年"),s}));this.gradeOptions=t},getCollegeList:function(){var e=this;Object(p["getCollegeList"])(1).then((function(t){return e.collegeOptions=t.data}))},getProfessionList:function(e){var t=this;Object(p["getProfessionList"])(e).then((function(e){return t.professionOptions=e.data}))},changeCollegeId:function(e){this.role===this.global.role_student&&(this.userExtension.professionId=null,this.professionOptions=null,this.getProfessionList(e))}}},m=v,b=(n("51f9"),Object(c["a"])(m,h,f,!1,null,"a1405fe2",null)),x=b.exports,E={name:"",data:function(){return{role:""}},beforeRouteLeave:function(e,t,n){"/login"===e.path&&this.$store.dispatch("user/resetToken"),n()},components:{ChooseRole:d,Register:x},mounted:function(){this.$store.getters.roles.length>0&&this.$router.push("/")}},_=E,O=(n("f14e"),Object(c["a"])(_,s,o,!1,null,"18ab003c",null));t["default"]=O.exports},8077:function(e,t,n){},a169:function(e,t,n){"use strict";var s=n("d3b0"),o=n.n(s);o.a},d3b0:function(e,t,n){},f14e:function(e,t,n){"use strict";var s=n("188b"),o=n.n(s);o.a}}]);